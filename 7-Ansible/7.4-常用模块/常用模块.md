# command
* command 模块用于在远程主机上执行命令，并返回命令的输出结果。它是 Ansible 的核心模块之一。
* 是默认的模块，可忽略-m选项
* command不支持`$VARNAME` 变量名 `<` `>` 重定向 `|` 管道符 `;` `&` 等操作符，这些需要用shell模块实现


常用参数说明
- chdir: ==先进入==到被管理主机目录，用cd是错误的
- creates: 如果有一个目录是存在，将不会运行命令
- removes: 如果有一个目录存在，将会执行命令
- 默认存不存在目录，都执行

>-a表示输入的参数，是args的缩写

ansible all -a "chdir=/datas/ ls"：先进入到/datas/目录下，再查看
![[Pasted image 20230811214430.png]]

删除文件

![[Pasted image 20230812111141.png]]

![[Pasted image 20230812111339.png]]

![[Pasted image 20230812111545.png]]

# shell
shell和command差不多，而且shell可以支持一些特殊命令，command能做的shell都能做

![[Pasted image 20230812120811.png]]

![[Pasted image 20230812121118.png]]

![[Pasted image 20230812121158.png]]

# script
`script` 模块是 Ansible 中的一个模块，它用于在远程主机上执行本地脚本文件。该模块允许你将本地脚本文件复制到远程主机，并在远程主机上执行该脚本。

下面为显示所有机器的名字

![[Pasted image 20230812121829.png]]

![[Pasted image 20230812121857.png]]

![[Pasted image 20230812121841.png]]

# copy
从主控端复制文件/目录到远程主机

常用参数
**src**		 	 	Ansible端源文件或者目录，空文件夹不拷贝，指定拷贝文件的本地路径，如果以                \结尾，则拷贝“\”下的所有文件
**content**		 	用来替代src，用于将指定文件的内容，拷贝到远程文件内；
**dest**			   指定目标路径
backup			备份源文件，如果文件已经存在，进行备份操作
> 拷贝之前，先备份远程节点上的原始文件；backup=yes，如果有需要的话

directory_mode	用于拷贝文件夹，新建的文件会被拷贝，而老旧的不会被拷贝；
follow			支持link文件拷贝；
force			    覆盖远程主机不一致的内容；
group		 	   设定远程主机文件夹的组名；
mode		 	   指定远程主机文件及文件及的权限；
owner		 	   设定远程主机文件夹的用户名，拥有者。

案例：在本机创建一个txt文件，然后拷贝到被控端主机上，再用command命令查看是否存在

![[Pasted image 20230812171217.png]]


![[Pasted image 20230812171142.png]]

# fetch
从远程主机提取文件至主控端，copy相反，目前不支持目录,可以先打包,再提取文件 如抓取日志操作
- dest
    - 将抓取的文件放在指定的目录下
    - 如：设置dest为 /backup，远端服务192.168.10.101机器上的/opt/hello.txt文件被抓取，则最终目录是/backup/192.169.10.101/opt/hello.txt
- src
    - 只能是文件，不能是目录
    - 只能抓取单个文件

![[Pasted image 20230812172844.png]]

![[Pasted image 20230812172856.png]]

# file
file模块用于在远程主机上管理文件和目录，对文件的创建、删除、修改、权限、属性的维护和管理。

常用参数介绍
1. `path`：指定要操作的文件或目录的路径。也可以用dest或name替代
    
    - 示例：path: /path/to/file.txt
2. `state`：定义文件或目录的状态。
    * `state=touch`：创建文件。
    - `state=file` 表示文件存在。
    - `state=directory` 创建文件夹。
    - `state=link` 创建软链接
    - `state=hard` 创建硬链接
    - `state=absent` 删除操作。
    - 示例：state: present
3. `mode`：设置文件或目录的权限模式。
    
    - 示例：mode: '0644'
4. `owner`：指定文件或目录的所有者。
    
    - 示例：owner: john
5. `group`：指定文件或目录的所属组。
    
    - 示例：group: developers
6. `recurse`：递归地对目录进行操作。
    
    - `recurse: yes` 表示递归操作。
    - `recurse: no` 表示不进行递归操作。
    - 示例：recurse: yes
7. `src`：指定源文件或目录的路径，用于复制或链接操作。
    
    - 示例：src: /path/to/source
8. `attributes`： 文件或者目录特殊属性。

案例一：创建文件
![[Pasted image 20230812183515.png]]

案例二：删除文件
![[Pasted image 20230812183745.png]]

案例三：创建文件夹
![[Pasted image 20230812183936.png]]

案例四：设置权限
ansible websrvs -m file -a "path=/root/test.sh owner=wang mode=755"  设置权限755

案例五：创建软链接
ansible websrvs -m file -a 'src=/data/testfile dest=/data/testfile-link state=link' 

# hostname
管理主机名

* 更改一个group的主机名
ansible appsrvs -m hostname -a "name=app.stt.com"

* 更改单个主机名
ansible 192.168.38.103 -m hostname -a "name=app2.stt.com"

# cron（不懂）
Ansible cron模块主要用于添加、删除、更新操作系统Crontab任务计划
计划任务 支持时间：minute,hour,day,month,weekday

常用参数
name      					任务计划名称；
cron_file 					替换客户端该用户的任务计划的文件；
minute    					分（ 0-59 ，* ，*/2 ）；
hour      					时（ 0-23 ，* ，*/2 ）；
day       					日（ 1-31 ，* ，*/2 ）；
month     					月（ 1-12 ，* ，*/2 ）；
weekday   					周（ 0-6 或 1-7 ，* ）；
job       					任何计划执行的命令，state要等于present；
backup    					是否备份之前的任务计划；
user      					新建任务计划的用户；
state     					指定任务计划present、absent。


案例一：创建任务
```shell
ansible websrvs -m cron -a 'minute=*/5 job=""/usr/sbin/ntpdate 172.16.0.1 &>/dev/null" name=Synctime'
```

案例二：删除任务
```
ansible websrvs -m cron -a 'state=absent name=Synctime'
```

案例三：注释任务，不再生效，必须添加name；如果启用则设置disabled=no，或者disabled=false
```shell
ansible websrvs -m cron -a 'minute=*/10 job="/usr/sbin/ntpdate 172.30.0.100" name=synctime disabled=yes'
```

# yum
yum 模块主要用于软件的安装、升级、卸载，支持红帽.rpm软件的管理

常用参数
conf_file					       设定远程yum执行时所依赖的yum配置文件
disable_gpg_check			    安装软件包之前是否坚持gpg  key；
name						          需要安装的软件名称，支持软件组安装；
update_cache				       安装软件前更新缓存；
enablerepo					       指定repo源名称；
skip_broken      			    跳过异常软件节点；
state					     软件包状态，包括：installed、present、latest、absent、removed。


示例：查看程序列表

```shell
# 依据名称查询
ansible websrvs -m yum -a 'list=httpd'
# 依据状态查询
ansible all -m yum -a 'list=installed'
```

示例：安装，state默认present

```shell
ansible websrvs -m yum -a 'name=httpd state=present'
```

示例：卸载，可以使用state=absent 或 state=removed

```shell
ansible websrvs -m yum -a 'name=httpd state=absent'
```

示例：安装多个包

```shell
ansible all -m yum -a 'name=vsftpd,memcached,httpd'
```

示例：卸载多个

```shell
ansible all -m yum -a 'name=vsftpd,memcached,httpd state=absent'
```

示例：安装本地的rpm包

```shell
ansible all -m yum -a 'name=/root/vsftpd-3.0.2-22.e17.x86_64.rpm'
# 禁用gpg check
ansible all -m yum -a 'name=/root/vsftpd-3.0.2-22.e17.x86_64.rpm disable_gpg_check=yes'
```


示例：更新某个软件的yum缓存，再安装

```shell
ansible all -m yum -a 'name=dstat update_cache=yes'
```

# service
service模块主要用于远程客户端各种服务管理，包括启动、停止、重启、重新加载等

常用参数
enabled				   是否开启启动服务；
name				      服务名称；
runlevel			      服务启动级别；
arguments			   服务命令行参数传递；
state				      服务操作状态，状态包括started, stopped, restarted, reloaded。

示例：停止服务

```shell
ansible all -m service -a 'name=httpd state=stopped'
```

示例：启动服务，并设置为开机启动

```shell
ansible all -m service -a 'name=httpd state=started enabled=yes'
```

示例：重新加载

```shell
ansible all -m service -a 'name=httpd state=reloaded'
```

示例：重启服务

```shell
ansible all -m service -a 'name=httpd state=restarted'
```

# user
user模块主要用于操作系统用户、组、权限、密码等操作

常用参数
system          				    默认创建为普通用户，为yes则创建系统用户；
append							    添加一个新的组；
comment 						       新增描述信息；
createhome 						 给用户创建家目录；
force							       用于删除强制删除用户；
group							       创建用户主组；
groups							    将用户加入组或者附属组添加；
home							       指定用户的家目录；
name							       表示状态，是否create、remove、modify；
password						       指定用户的密码，此处为加密密码；
remove							    清楚账户，删除文件夹，目录等
shell							       设置用户的shell登录环境；
uid								    设置用户id；
update_password 				    修改用户密码；
state           				    用户状态，默认为present表示新建用户。absent表示删除

示例：增加用户user1，主组是root，home目录是/app/user1，指定uid

```shell
ansible websrvs -m user -a 'name=user1 comment="test user" uid=2048 home=/app/user1 group=root'
```

示例：增加系统用户 system=yes

```shell
ansible websrvs -m user -a 'name=sysuser1 system=yes home=/app/sysuser1'
```

示例：清空用户所有数据，包含家目录文件夹数据

```shell
ansible websrvs -m user -a 'name=user1 state=absent remove=yes'
```

示例：创建用户

```shell
ansible websrvs -m user -a 'name=app uid=88 system=yes home=/app groups=root,bin shell=/sbin/nologin password="$1$zfVojmPy$ZILcvxnXljvTI2PhP2Iqv1"'
```

示例：删除账户，但不删除家目录

```shell
ansible websrvs -m user -a 'name=app state=absent'
```

# Group
用户组管理

常用参数
- name
- state，默认present
- system，是否是系统组
- gid，组id

示例：创建组

```
ansible all -m group -a 'name=testgroup system=yes gid=80'
```

示例：删除组

```
ansible all -m group -a 'name=testgroup state=absent'
```

# unarchive 解包解压缩
解包解压缩

使用方法

- 将ansible主机上的压缩包传到远程主机后解压缩至特定目录，设置copy=yes
- 将远程主机上的某个压缩包解压缩到指定路径下，设置copy=no

常见参数

- copy
    
    - 默认yes
    - 当copy=yes时，拷贝的文件是从ansible主机复制到远程主机上
    - 当copy=no时，在远程主机上寻找src源文件
- src
    
    - 源路径
    - 是ansible主机上的路径，或者是远程主机上的路径
    - 如果是远程主机上的路径，则需要设置copy=no
- dest
    
    - 远程主机上的目标路径
- mode
    
    - 设置解压缩后的文件权限

示例：默认copy为yes ,将本机目录文件解压到目标主机对应目录下

```shell
ansible websrvs -m unarchive -a 'src=foo.tgz dest=/var/lib/foo'
```

示例：解压被管理主机的foo.zip到data目录下, 并设置权限777

```shell
ansible websrvs -m unarchive -a 'src=/tmp/foo.zip dest=/data copy=no mode=0777'
```

示例：从网络上下载并解压，注意copy=no

```shell
ansible websrvs -m unarchive -a 'src=https://example.com/example.zip dest=/data copy=no'
```

# archive 打包压缩
常用参数

- path，指定路径
- dest，指定目标文件
- format，指定打包格式
- owner，指定所属者
- mode，设置权限

示例
```shell
ansible all -m archive -a 'path=/etc/sysconfig dest=/data/sysconfig.tar.bz2 format=bz2 owner=wang mode=0777'
```

