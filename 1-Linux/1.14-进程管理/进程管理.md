# 进程管理基础

* 在Linux中，每个执行的程序（代码）都称为一个进程。每个进程都分配一个ID号
* 每一个进程，都会对应一个父进程，而这个父进程可以复制多个子进程。例如www服务器。
* 每个进程都可能以两种方式存在。前台和后台。
  *  前台进程：用户目前的屏幕上可以进行操作的。
  * 后台进程：实际在操作，但由于屏幕上无法看到的进程，通常使用后台方式执行。
* 一般系统的服务都是以后台进程的方式存在，而且都会常驻在系统中，直到关机才结束。

## 显示系统执行的进程
![[Pasted image 20230724185823.png]]
### ps指令详细介绍
用于查看进程信息

> ps [选项]：可用于查看目前系统中，有哪些正在执行，以及它们执行的状况

* ps -a：显示当前终端的所有进程信息。
* ps -u：以用户的格式显示进程信息。

*ps -u 用户名：后接用户名，查看指定用户的*进程信息 

* ps -x：显示后台进程运行的参数。
* ps -aux
* ps -axu | grep xxx：过滤得到xxx的信息。

* -e：显示所有进程。
* -f：全格式。
* ps -ef：以全格式显示当前所有的进程，可查看到进程的父进程。

案例1 ：ps -aux | grep sshd
![[Pasted image 20230724190929.png]]

案例2 ：ps -ef | more：查看父进程
![[Pasted image 20230724191316.png]]

字段|说明
---|---
USER|用户说明
PID|进程识别号
%CPU|进程占用cpu百分比
%MEM|进程占用物理内存百分比
VSZ|进程占用虚拟内存大小(KB)
RSS|进程占用物理内存大小(KB)
TTY|终端机号
STAT|进程状态，S睡眠，s代表是会话的先导进程，N代表进程拥有比普通进程更高的优先级，R正在运行，D短期等待，Z僵死进程，T被跟踪或被停止
STARTED|进程启动的时间
TIME|此进程所消耗的CPU时间
COMMAND|正在执行的命令或进程名

字段|说明
---|---
UID|用户id
PID|进程id
PPID|父进程
C|CPU用于执行优先级的因子，数值越大，表明cpu密集型运算，执行优先级会降低，数值越小，表明是I/O密集运算，执行优先级会提高
STIME|进程启动时间
TTY|终端机号
TIME|此进程所消耗的CPU时间
CMD|启动所用的命令和参数

## 终止进程

> 若是某个进程执行一半需要停止时，或是消耗了很大的系统资源时，此时可以考虑停止该进程，使用kill命令来完成此任务

### 一、kill
格式：`kill [选项] 进程号：通过进程号杀死进程`

常见选项：
- `-l`：列出支持的信号列表。
- `-s <信号>`：指定要发送的信号。
- `-<信号>`：使用信号的缩写形式来发送信号。

常用信号：
- `SIGTERM`（默认）：终止进程。这是常用的正常终止信号。
- `SIGKILL`：强制终止进程。该信号会立即终止进程，但不会执行清理操作。
- `SIGINT`：中断进程。通常由终端上的 Ctrl+C 键触发

示例：

1. 终止进程：

```
kill 1234
```

这将向进程ID为 1234 的进程发送默认的终止信号（SIGTERM）。

2. 使用不同的信号终止进程：

```
kill -s SIGKILL 5678
```

这将向进程ID为 5678 的进程发送强制终止信号（SIGKILL）。

3. 列出支持的信号列表：

```
kill -l
```

这将列出系统支持的所有信号。

### 二、killall 
格式：`killall [选项] 进程名称`：
* 与`kill` 命令不同，`killall` 命令使用进程的名称而不是进程ID来识别要终止的进程。
* 这在系统因负载过大而变得很慢时很有用

常见选项：

- `-e`：精确匹配进程名称。默认情况下，`killall` 使用模糊匹配来终止与给定名称相匹配的所有进程。使用 `-e` 选项可以进行精确匹配。
- `-s <信号>`：指定要发送的信号。
- `-<信号>`：使用信号的缩写形式来发送信号。

示例：

1. 终止所有具有相同名称的进程：

```
killall firefox
```

这会终止所有名称为 "firefox" 的进程。

2. 终止所有具有相同名称的进程并发送不同的信号：

```
killall -s SIGTERM chrome
```

这会终止所有名称为 "chrome" 的进程，并发送终止信号（SIGTERM）。

3. 精确匹配进程名称：

```
killall -e myprocess
```

这会精确匹配名称为 "myprocess" 的进程，并终止它。



### 案例

> 案例1：踢掉某个非法用户

* ps -aux | grep sshd
* kill 进程号

> 案例2：终止远程服务

![[Pasted image 20230724195054.png]]

> 案例3：终止多个gedit编辑器

![[Pasted image 20230724195111.png]]


> 案例4： 强制杀掉一个终端

![[Pasted image 20230724195137.png]]

## pstree查看进程树

* 查看进程树：`pstree [选项]`

常见选项：
- `-p`：显示进程的进程ID（PID）。
- `-u`：显示进程的所属用户。
- `-h`：以平面格式而非树状格式显示进程。

![[Pasted image 20230724225317.png]]

# 服务(Service)管理
服务(Service)本质就是进程，但是是运行在后台的，通常都会监听某个端口，等待其它程序的请求，比如(mysql,sshd 防火墙等),因此我们又称为守护进程。

>[!warning] 
> 1. 在Linux中，"服务"（Service）是指在操作系统上运行的后台进程或守护进程，它们提供特定功能或服务，并在系统启动时自动启动。服务通常以持续运行的方式提供功能，而不需要用户交互或直接的终端操作。
> 1. Linux中的服务可以是各种各样的，例如网络服务（如Web服务器、数据库服务器）、系统服务（如日志服务、时间同步服务）、文件服务（如文件共享服务）等。这些服务通过监听网络端口、处理请求和提供相应的功能，使得其他计算机或用户能够访问和使用它们提供的服务。
> 2. 在Linux系统中，服务通常由服务管理器（Service Manager）来管理和控制。常见的Linux服务管理器包括Systemd、SysVinit和Upstart等。服务管理器负责启动、停止、重启和监视服务的运行状态，并在系统引导时自动启动所需的服务。

>[!seealso]
>守护进程（Daemon）是在计算机系统中以后台方式运行的一类特殊进程。它们通常在系统引导过程中启动，并在系统运行期间持续运行，独立于用户会话的控制。守护进程通常没有交互界面，它们在后台默默地执行任务，提供系统服务、监控资源或处理特定的系统功能。
> 
> 以下是一些守护进程的实例：
> 
> 1. **sshd**：sshd 是 SSH（Secure Shell）守护进程，负责监听和处理远程用户的 SSH 连接请求。它提供了安全的远程登录和文件传输功能，并通过加密通信保护数据的传输。
>     
> 2. **httpd**：httpd 是用于 HTTP 通信的守护进程，例如 Apache HTTP Server 或 Nginx。它们在后台运行，并接受来自客户端的 HTTP 请求，处理这些请求并向客户端返回相应的网页内容。
>     
> 3. **cron**：cron 是一个守护进程，用于定期执行预定的任务。它根据预先定义的时间表（Cron 表达式）触发脚本或命令的执行，例如定时备份数据、生成报告或清理临时文件等。
>     
> 4. **syslogd**：syslogd 是一个守护进程，负责接收、处理和记录系统日志消息。它允许不同的应用程序和服务将日志消息发送到统一的日志系统，便于系统管理员进行故障排查和日志分析。
>     
> 5. **sssd**：sssd（System Security Services Daemon）是一个守护进程，用于统一身份认证和授权服务。它提供了对用户身份验证、用户信息查询以及访问控制策略的支持，使得多个系统和服务可以共享认证和授权机制。



![[Pasted image 20230724230511.png]]



## service管理指令
* service管理指令：service 服务名 [start | stop | restart | reload | status]
* 在CentOS7.0之后，不再使用service，而是systemctl，即将service换成systemctl即可，其他都一样

下面是 `systemctl` 命令的一些常见用法和示例：

1. 查看服务状态：
systemctl status <service-name>
这将显示指定服务的运行状态、最后一次活动等相关信息。

2. 启动服务: 
systemctl start <service-name>

3. 停止服务：
systemctl stop <service-name>

4. 重启服务
systemctl restart <service-name>

5. 查看服务列表
systemctl list-units --type=service
这将显示当前系统上所有服务的列表。

6. 启用自启动服务
systemctl enable <service-name>

7. 禁用自启动服务
systemctl disable <service-name>


案例
1. 查看防火墙情况：
  * service nftables status
  * systemctl status firewalld（7.0之后的版本是这个命令）
![[Pasted image 20230724232525.png]]

注意点
* 关闭或者启用防火墙后，立即生效。
* ==简单测试某个端口是否在监听：telnet Ip地址 端口号==。
* 以上的方式只是临时生效，当重启系统后，还是回归以前对服务的设置。
* 如果希望设置某个服务自启动或关闭永久生效，要使用 chkconfig 指令。

![[Pasted image 20230724232916.png]]


## 服务查看方式

* 方式1：setup指令（可能只有centos行）

* 方式2：ls -l /etc/init.d/
![[Pasted image 20230724233234.png]]

## 服务的运行级别（runlevel）
查看或者修改默认级别： vi /etc/inittab 
Linux 系统有 7 种运行级别(runlevel)：常用的是级别 3 和 5 
•运行级别 0：系统停机状态，系统默认运行级别不能设为 0，否则不能正常启动
•运行级别 1：单用户工作状态，root 权限，用于系统维护，禁止远程登陆
•运行级别 2：多用户状态(没有 NFS)，不支持网络 
•运行级别 3：完全的多用户状态(有 NFS)，登陆后进入控制台命令行模式
•运行级别 4：系统未使用，保留 
•运行级别 5：X11 控制台，登陆后进入图形 GUI 模式 
•运行级别 6：系统正常关闭并重启，默认运行级别不能设为 6，否则不能正常启动

## 开机流程
![[Pasted image 20230724233611.png]]


## chkconfig指令
`chkconfig` 命令用于管理系统服务的运行级别（runlevel）配置。它允许您控制特定服务在不同运行级别下的启动和停止行为。

chkconfig：可以给每个服务的各个运行级别设置自启动/关闭

基本语法
==Ubuntu 等系统中 chkconfig 已经被 sysv-rc-conf 所替代==
* 查看xxx服务：chkconfig –list | grep xxx
* 查看服务的状态：chkconfig 服务名 --list
* 给服务的运行级别设置自启动：chkconfig –level 5 服务名 on/off
* 要所有运行级别关闭或开启：chkconfig 服务名 on/off
* **chkconfig重新设置后需要重新启动才能生效**

# 动态监控进程

top与ps相似，都是用来显示正在执行的进程，top的不同之处在于top执行一段时间可以更新正在运行的进程

基本语法
> top [选项]
>
>* -d 秒数：指定top命令每隔几秒更新。默认是3秒。
>* -i：使top不显示任何闲置或者僵死进程。
>* -p：通过指定监控进程ID来仅仅监控某个进程的状态。

* 交互操作说明：
即按什么去排序
在top命令执行后，可以按下按键得到对显示的结果进行排序


操作|功能
---|---
P|以CPU使用率排序，默认就是此项
M|以内存的使用率排序
N|以PID排序
q|退出top


## 应用案例

### 监控特定用户

1. top查看进程；
2. 输入u，再回车
3. 输入用户名。
4. 按q退出
![[Pasted image 20230725000950.png]]

### 终止指定的进程

1. top查看进程；
2. 输入k再回车，输入要结束的进程号。
3. 按q退出

### 指定系统状态更新的时间
使其每隔10秒自动更新， 默认是3 秒
top -d 10
## 查看网络状态

netstat [选项]
* -an：按一定顺序排列输出
* -p：显示哪个进程在调用


>[!danger] 常用参数
> **1. `-a`：** 显示所有活动的网络连接，包括 TCP 和 UDP 连接。
> 
> **2. `-l`：** 仅显示处于监听状态的网络连接，包括正在侦听传入连接的本地端口。
> 
> **3. `-i`：** 显示网络接口信息，包括接口名称、MTU（最大传输单元）、接收和发送的数据包数量等。
> 
> **4. `-r`：** 显示系统的路由表信息，包括目标网络、网关、接口和跃点数等。
> 
> **5. `-p`：** 显示与每个网络连接相关联的进程ID（PID）和进程名称。
> 
> **6. `-n`：** 显示数字格式的 IP 地址和端口号，而不进行域名解析。
> 
> **7. `-t`：** 仅显示 TCP 连接。
> 
> **8. `-u`：** 仅显示 UDP 连接。
> 
> **9. `-c`：** 持续显示网络信息，以动态方式更新显示，类似于实时监控。


### 应用案例

1. 查看所有的网络服务
    * netstat -anp | more

2. 查看sshd的服务的信息
    * netstat -anp | grep sshd
![[Pasted image 20230725002531.png]]