# 数据卷的概念
1. 数据卷的基本概念
数据卷是宿主机中的一个可供一个或多个容器使用的特殊目录或文件，可以在容器和宿主机之间进行数据共享，并且在容器删除后数据仍然保留在宿主机上。当容器目录和数据卷目录绑定后，对方的修改会立即同步。一个数据卷可以被多个容器同时挂载，一个容器也可以被挂载多个数据卷。
>数据卷的更新不会影响镜像

![[Pasted image 20230802201358.png]]

2. 数据卷的作用
- 容器数据持久化，容器删除后，数据不会删除，同时方便数据的备份。
- 外部机器和容器间接通信
- 容器之间数据交换

# 配置数据卷
## 1. 创建启动容器时使用-v参数设置数据卷
docker run -it/d --name=c1  -v 宿主机目录(文件):容器内目录(文件) 镜像名:版本号 /bin/bash（==/bin/bash同样是可以省略的==）



![[Pasted image 20230802204523.png]]

新开一个终端也看到了创建的data文件
![[Pasted image 20230802204654.png]]

<center>演示可知数据共享与同步</center>
![[Pasted image 20230802205023.png]]

<center>删除容器后，宿主机中的数据仍然存在</center>
![[Pasted image 20230802205750.png]]

## 2. 挂载多个数据卷（用多个-v来设置）
docker run -v /path/on/host1:/data1 -v /path/on/host2:/data2 myimage
>注意
>目录必须是绝对路径
>如果目录不存在，会自动创建目录
>可以挂载多个数据卷


<center>一个容器挂载到多个目录</center>
![[Pasted image 20230802210654.png]]

## 两个容器挂载同一个数据卷

实现两个容器间的数据共享
![[Pasted image 20230802211714.png]]

![[Pasted image 20230802213458.png]]

![[Pasted image 20230802213604.png]]

# 数据卷容器
多容器进行数据交换的两种方法
1. 多个容器挂载同一个数据卷
2. 数据卷容器
这里c1和c2进行数据共享就有两条路径
![[Pasted image 20230802220312.png]]

如图，C3就是数据卷容器，
## 配置数据卷容器
1. 创建启动C3数据卷容器，使用-V参数设置数据卷
docker run -it --name=c3 -v /volume centos:7 /bin/bash

2. 创建启动C1，C2容器，使用--volumes-from参数设置数据卷
docker run -it --name=c1 --volumes-from c3 centos:7 /bin/bash
docker run -it --name=c2 --volumes-from c3 centos:7 /bin/bash

![[Pasted image 20230802224409.png]]

# 匿名挂载和具名挂载
## 匿名挂载
docker run -d -P --name=nginx01 -v /etc/nginx nginx
>-v 后面仅是容器内的路径，没有写容器外的路径

>这里为了方便就直接使用大写的P，随机指定端口了

docker volume：查看所有的volume（卷）的情况

![[Pasted image 20230804203103.png]]
## 具名挂载
docker run -d -P --name=nginx02 -v juming-nginx:/etc/nginx nginx
>-v 卷名 容器内路径，只是起了个名字

![[Pasted image 20230804203537.png]]

## 共同点
所有docker容器内的卷，没有指定目录下，都是在==/var/lib/docker/volumes/==下
通过具名挂载可以方便地找到卷，不建议使用匿名挂载
![[Pasted image 20230804204107.png]]

![[Pasted image 20230804205154.png]]

三种挂载： 匿名挂载、具名挂载、指定路径挂载
-v 容器内路径		--匿名挂载
-v 卷名：容器内路径		 --具名挂载
-v /宿主机路径：容器内路径  --指定路径挂载 docker volume ls 是查看不到的

拓展
```shell
# 通过 -v 容器内路径： ro、rw是改变读写权限
ro #readonly 只读
rw #readwrite 可读可写
$ docker run -d -P --name nginx05 -v juming:/etc/nginx:ro nginx
$ docker run -d -P --name nginx05 -v juming:/etc/nginx:rw nginx

# 只要看到ro就说明这个路径只能通过宿主机来操作，容器内部是无法操作！
# 默认的是rw
```