# 准备工作
## 安装tomcat jdk
1. 安装tomcat。
2. 解压
>根据视频教程。还是放到/usr/src目录下吧

3. 安装jdk
[(141条消息) Linux系统下安装jdk及环境配置（两种方法）_linux安装jdk_凉凉的西瓜的博客-CSDN博客](https://blog.csdn.net/qq_42815754/article/details/82968464?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522169076232716800226513365%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=169076232716800226513365&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-82968464-null-null.142^v91^insert_down1,239^v12^control2&utm_term=linux%E4%B8%AD%E5%AE%89%E8%A3%85jdk&spm=1018.2226.3001.4187)

这里省时直接采用Yum一键安装
* yum install -y java-1.8.0-openjdk-devel.x86_64

* java -version：检查jdk是否还存在

![[Pasted image 20230731080512.png]]

![[Pasted image 20230731080953.png]]

![[Pasted image 20230731081606.png]]
## 启动
切换进目录：cd /usr/src/apache-tomcat-版本/bin

启动：./startup.sh

进入日志查看启动效果

切换到日志目录：cd /usr/src/apache-tomcat-版本/logs

查看启动日志：tail -f catalina.out

![[Pasted image 20230731082533.png]]

![[Pasted image 20230731082549.png]]

## 开放对外访问端口

1. 启动防火墙：sudo systemctl start firewalld
2. 3. 查看防火墙状态：sudo firewall-cmd --state
3. 查看已经开放的端口号：firewall-cmd --list-all
4. 添加对外开放的端口：firewall-cmd --add-port=8080/tcp --permanent
5. 重新加载：firewall-cmd --reload
6. 删除开放的端口：sudo firewall-cmd --zone=public --remove-port=8096/tcp --permanent

![[Pasted image 20230731083547.png]]


## 问题解决
[(141条消息) Linux中安装tomcat，外网无法访问_tomcat外部不能访问_爱篮球的小码long的博客-CSDN博客](https://blog.csdn.net/qq_50839597/article/details/125017853?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522169076409616800226584269%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&request_id=169076409616800226584269&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~rank_v31_ecpm-12-125017853-null-null.142^v91^insert_down1,239^v12^control2&utm_term=linux%E4%B8%ADtomcat%E6%97%A0%E6%B3%95%E6%89%93%E5%BC%80&spm=1018.2226.3001.4187)

1. 查看8080端口真正被占用：sudo netstat -tunlp | grep 8080
这个命令将列出所有占用 8080 端口的进程和服务的详细信息，如果该端口没有被占用，则命令将没有任何输出。
2.  sudo lsof -i:8080也可以看出端口是否被占用
![[Pasted image 20230731093632.png]]

3. 在云服务器上添加安全组，开放端口
![[Pasted image 20230731093731.png]]
4. 如果想更改端口号，可以进入conf文件中的server.xml进行更改

![[Pasted image 20230731093838.png]]

# 反向代理实例1
## 实现效果
打开浏览器，在浏览器地址栏输入地址 www.123.com，跳转到 liunx 系统 tomcat 主页面中
![[Pasted image 20230731094319.png]]

## 具体配置
1. 在 windows 系统的 host 文件进行域名和 ip 对应关系的配置（==以下情况只适合本地虚拟机，云服务器需要域名备案，所以访问不了）==

![[Pasted image 20230731100910.png]]

![[Pasted image 20230731101811.png]]

![[Pasted image 20230731105410.png]]

2. nginx中配置

![[Pasted image 20230731102359.png]]

设置请求转发配置（反向代理配置）
server中的localhost改为本机IP地址，使其通过IP可以访问
location中添加proxy_pass http://IP:端口 ；==记得加分号==
![[Pasted image 20230731105357.png]]
3. 开启nginx服务
![[Pasted image 20230731104840.png]]

./nginx

4. 最终测试

![[Pasted image 20230731105433.png]]

## 反向代理实例2
### 实现效果
使用 nginx 反向代理，根据访问的路径跳转到不同端口的服务中

nginx 监听端口为 9001，

访问 http://192.168.17.129:9001/edu/ 直接跳转到 127.0.0.1:8080

访问 http:// 192.168.17.129:9001/vod/ 直接跳转到 127.0.0.1:8081
### 准备工作
1. 准备两个 tomcat 服务器，一个 8080 端口，一个 8081 端口，然后各自都启动

![[Pasted image 20230731120004.png]]

![[Pasted image 20230731120332.png]]

打开server.xml进入

![[Pasted image 20230731120450.png]]

![[Pasted image 20230731120529.png]]

![[Pasted image 20230731120629.png]]

2. 创建文件夹和测试页面

tomcat 加载是加载的 webapps 中的东西，所以放在该文件夹下 。

在`/Tomcat8080/apache-tomcat-7.0.106/webapps`中，新建 edu 文件夹，并在该文件夹下新建文件 a.html，

内容如下

```<h1>8080</h1>```

在`/Tomcat8081/apache-tomcat-7.0.106/webapps`中，新建 vod 文件夹，并在该文件夹下新建文件 a.html，

内容如下：

```
<h1>8081</h1>
```
### 具体配置
1）找到 nginx 配置文件，进行反向代理配置

> 三处改变：监听端口 + nginx地址 + 转发地址

![[Pasted image 20230731155133.png]]

（2）开放对外访问的端口号 9001 8080 8081

### 最终测试
重启Nginx
![[Pasted image 20230731155218.png]]

![[Pasted image 20230731155241.png]]

### location指令说明
该指令用于匹配 URL。

语法如下：

1、= ：用于不含正则表达式的 uri 前，要求请求字符串与 uri 严格匹配，如果匹配成功，就停止继续向下搜索并立即处理该请求。

2、~：用于表示 uri 包含正则表达式，并且区分大小写。

3、~*：用于表示 uri 包含正则表达式，并且不区分大小写。

4、^~：用于不含正则表达式的 uri 前，要求 Nginx 服务器找到标识 uri 和请求字符串匹配度最高的 location 后，立即使用此 location 处理请求，而不再使用 location 块中的正则 uri 和请求字符串做匹配。

**注意：*如果 uri 包含正则表达式，则必须要有 ~ 或者 ~ 标识。


