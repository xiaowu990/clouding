# 二进制安装
1. tar
2. mv prometheus-2.46.0.linux-amd64 /usr/local/prometheus
3. 

![[Pasted image 20230816185710.png]]

添加到系统服务
vi /usr/lib/systemd/system/prometheus.service

输入以下内容
```shell
[Unit]
Description=https://prometheus.io
#描述信息
[Service]
Restart=on-failure
ExecStart=/usr/local/prometheus/prometheus \
#上面设定的prometheus二进制程序的位置所在处
--storage.tsdb.path=/usr/local/promethues/data \
#data的目录，就是数据存放的位置
--config.file=/usr/local/prometheus/prometheus.yml
#配置文件
[Install]
WantedBy=multi-user.target
```

如果出现报错，就不要添加中文，使用下面纯英文的
```shell
[Unit]
Description=https://prometheus.io
[Service]
Restart=on-failure
ExecStart=/usr/local/prometheus/prometheus \
--storage.tsdb.path=/usr/local/promethues/data \
--config.file=/usr/local/prometheus/prometheus.yml
[Install]
WantedBy=multi-user.target
```

systemctl start prometheus 
systemctl status prometheus
netstat -lntup | grep 9090
设置开机启动：systemctl enable prometheus

![[Pasted image 20230816191312.png]]

![[Pasted image 20230816191450.png]]

 vim prometheus.yml   查看配置文件
![[Pasted image 20230816191600.png]]

在浏览器中输入IP:端口（默认9090），可以见到其web页面
![[Pasted image 20230816191736.png]]
![[Pasted image 20230816192236.png]]

![[Pasted image 20230816192307.png]]
## 注意点
==必要时进行时间同步：ntpdate pool.ntp.org==
或
在所有节点上安装 `ntpdate` 工具，并进行时间同步（因为 Prometheus 对时间要求非常严格）
yum -y install ntpdate
/usr/sbin/ntpdate ntp1.aliyun.com

## 错误
出现这种情况，考虑关闭防火墙或者设置开放端口。
例如：直接关闭防火墙：systemctl stop firewalld
或者
1. 设置要开放的端口：sudo firewall-cmd --zone=public --add-port=9090/tcp --permanent
2. 重启生效：sudo firewall-cmd --reload

![[Pasted image 20230817164048.png]]



## 更全的安装部署教程

[我在B站学运维之Prometheus监控基础环境安装配置与实践(2) - 哔哩哔哩 (bilibili.com)](https://www.bilibili.com/read/cv13299364)
# 使用promethues实现监控系统

- 因为 Prometheus 并不能直接监控服务，其主要任务负责数据的收集，存储并对外提供数据查询支持；
- 因此，为了能够监控到某些东西，如：主机的 CPU 使用率，我们需要使用到 Exporter。
## 安装Node_Exporter
```shell
在官网下载安装包，然后通过sftp传输到虚拟机，直接在浏览器输入以下网址即可下载 https://github.com/prometheus/node_exporter/releases/download/v0.18.1/node_exporter-0.18.1.linux-amd64.tar.gz
![[Pasted image 20230817100242.png]]
```shell
[root@k8smaster src]# tar xf node_exporter-0.18.1.linux-amd64.tar.gz 
[root@k8smaster src]# mv node_exporter-0.18.1.linux-amd64 /usr/local/node_exporter
[root@k8smaster src]# vim /usr/lib/systemd/system/node_exporter.service
```

```shell
[Unit]
Description=prometheus node_exporter
[Service]
User=nobody
ExecStart=/usr/local/node_exporter/node_exporter --log.level=error
ExecStop=/usr/bin/killall node_exporter
[Install]
WantedBy=default.target
```

systemctl start node_exporter 
systemctl status node_exporter 
netstat -lntup | grep 9100
> 默认端口是9100

设置开机启动：systemctl enable node_exporter

同样的，不能打开记得关闭防火墙即可


如下图表示成功
![[Pasted image 20230817175243.png]]

## 修改配置
添加9100节点
去prometheus配置文件中修改添加 vim /usr/local/prometheus/prometheus.yml
添加如下内容
```shell
- job_name: 'host_monitor'
    static_configs:
      - targets: ['localhost:9100']
```

![[Pasted image 20230817180322.png]]

重启一下生效：systemctl restart prometheus

![[Pasted image 20230817180610.png]]

