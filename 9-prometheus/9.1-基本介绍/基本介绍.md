![[Pasted image 20230816094113.png]]

# 基本概念
Prometheus（普罗米修斯）是一种开源的监控和警报工具，用于收集和分析系统和服务的指标数据，由 SoundCloud 公司开发。泛义上包括监控，告警，时序数据库(TSDB)，各种指标收集器(Exporter)组成。现在最常见的Kubernetes容器管理系统中，通常会搭配Prometheus进行监控, 所以它主要用于容器监控和k8s集群监控以及云环境的监控(OpenStack)。

>2016年 Prometheus 加入了云原生计算基金会(Cloud Native Computing Foundation,CNCF)，成为kubernetes之后的第二个托管项目 google SRE 的书内也曾提到跟他们BorgMon监控系统相似的实现是Prometheus。 
# 特点与特性
优点
1. 简单易用：Prometheus具有简单的安装和配置过程，使用方便。它提供了一个直观的Web界面和强大的查询语言，使用户能够轻松地查看和分析指标数据。
    
2. 多维度数据模型：Prometheus使用标签（Labels）来对指标数据进行多维度的分类和标识，这为灵活的查询和数据分析提供了便利。标签可以用于筛选和聚合数据，使用户能够更好地理解系统行为。
    
3. 动态服务发现：Prometheus支持自动发现目标实例，这对于在动态环境中部署和管理应用程序非常有用。它可以与容器编排系统（如Kubernetes）集成，自动发现和监控新加入的服务实例。
    
4. 警报和通知：Prometheus具有强大的警报功能，可以设置灵活的警报规则，并通过多种方式（如电子邮件、Slack等）发送警报通知。这使得用户能够及时响应和解决系统中的问题。
    
5. 可扩展性：Prometheus可以通过水平扩展来处理大规模的指标数据。用户可以添加更多的实例来分担负载和提高性能，以满足不断增长的监控需求。
    

缺点：
1. 存储限制：Prometheus使用本地的时间序列数据库来存储指标数据，这可能会受到存储容量的限制。长期存储大量数据可能需要额外的配置和管理。
    
2. 高度依赖于拉取模型：Prometheus使用拉取模型从目标实例主动获取指标数据，这对于大规模系统可能带来一些挑战。如果目标实例数量庞大，或者指标数据频繁变动，可能会对网络带宽和资源造成压力。
    
3. 缺乏分布式跟踪和日志功能：Prometheus主要关注指标数据的收集和分析，而在分布式跟踪和日志方面相对较弱。对于全面的系统监控和故障排查，可能需要与其他工具进行集成。
    
4. 配置复杂性：虽然Prometheus提供了丰富的功能和配置选项，但对于初学者来说，理解和配置规则、警报规则等可能需要一些学习和实践。

# 架构组件
![[Pasted image 20230816095653.png]]

==从上图可发现，Prometheus整个生态圈组成主要包括prometheus server，Exporter，pushgateway，alertmanager，grafana，Web ui界面==

1.`Prometheus server` : 是Prometheus组件中的核心部分，负责实现对监控数据的获取、存储以
查询，提供PromQL查询语言的支持 (默认端口: 9090)
   - `Retrieval`负责在活跃的target主机上抓取监控指标数据
   - `Storage`存储主要是把采集到的数据存储到磁盘中
   - `PromQL`是Prometheus提供的查询语言模块。

2.`exporters` ：exporter简单说是采集端。通过http服务的形式保留一个url地址，prometheus server通过访问该exporter提供的endpoint端点即可获取到需要采集的监控数据。

3.`AlertManager` : 在prometheus中，支持基于PromQL创建告警规则，如果满足定义的规则，则会产生一条告警信息，进入AlertManager进行处理。可以集成邮件，微信或者通过webhook自定义报警
> prometheus_cli：命令行工具 (默认端口: 9093)

5.`PushGateWay`：由于Prometheus数据采集采用pull方式进行设置的，内置必须保prometheus server和对应的exporter必须通信，当网络情况无法直接满足时。可以使用pushgateway来进行中转,可以通过pushgateway将内部网络数据主动push到gateway里面去,而prometheus采用pull方式拉取pushgateway中数据。

7. `Grafana`：监控仪表盘，可视化监控数据

==总结：prometheus负责从pushgateway和job中采集数据，存储到后端Storatge中，可以通过PromQL进行查询，推送alerts信息到AlertManager。AlertManager根据不同的路由规则进行报警通知。==

# zabbix与prometheus
